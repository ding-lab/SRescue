/*
 * Configuration file for SV Validation Pipeline
 */

// Global default params, used in configs
params {
    // Pipeline Options
    help = false

    // Input/Output
    samplelist = null
    outdir = "results"
    
    // Tools
    survivor = "SURVIVOR"
    cutesv = "cuteSV"
    bgzip = "bgzip"
    tabix = "tabix"
    script_path = "${projectDir}/bin"
    ref = "ref.fa"
    samtools = "samtools"
    
    // Resources
    max_memory = '128.GB'
    max_cpus = 16
    max_time = '48.h'
}

// Container configurations
process {
    // Default container to use unless overridden
    container = 'scao/dailybox'
    
    withLabel: survivor {
        cpus = { 1 }
        memory = { 10.GB * task.attempt }
    }
    
    withLabel: cutesv {
        cpus = { 2 }
        memory = { 80.GB * task.attempt }
    }
    
    withLabel: processing {
        cpus = { 1 }
        memory = { 10.GB * task.attempt }
    }
}

// Executor configurations
executor {
    name = 'local'
    queueSize = 10
}

// Enable Docker or Singularity
docker {
    enabled = true
    runOptions = '-u $(id -u):$(id -g)'
}

singularity {
    enabled = false
    autoMounts = true
}

// LSF profile
profiles {
    lsf {
        process {
            executor = 'lsf'
            queue = 'general'
            clusterOptions = { "-R 'select[mem>${task.memory.toMega()}] rusage[mem=${task.memory.toMega()}]' -M ${task.memory.toMega()}" }
        }
        executor {
            name = 'lsf'
            queueSize = 50
        }
    }
}

// Manifest information
manifest {
    name = 'SV Validation Pipeline'
    author = 'Original: ywzhang0713@gmail.com, Nextflow conversion: [Your Name]'
    mainScript = 'main.nf'
    description = 'Pipeline for validating SVs detected by short-read WGS using Tumor-Normal long-read WGS'
    version = '1.0.0'
}

// Function to generate a more complex configuration
def check_max(obj, type) {
    if (type == 'memory') {
        try {
            if (obj.compareTo(params.max_memory as nextflow.util.MemoryUnit) == 1)
                return params.max_memory as nextflow.util.MemoryUnit
            else
                return obj
        } catch (all) {
            println "ERROR: Max memory '${params.max_memory}' is not valid! Using default value: $obj"
            return obj
        }
    } else if (type == 'time') {
        try {
            if (obj.compareTo(params.max_time as nextflow.util.Duration) == 1)
                return params.max_time as nextflow.util.Duration
            else
                return obj
        } catch (all) {
            println "ERROR: Max time '${params.max_time}' is not valid! Using default value: $obj"
            return obj
        }
    } else if (type == 'cpus') {
        try {
            return Math.min( obj, params.max_cpus as int )
        } catch (all) {
            println "ERROR: Max cpus '${params.max_cpus}' is not valid! Using default value: $obj"
            return obj
        }
    }
}